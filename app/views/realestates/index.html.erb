<!-- ============================ Page Title Start================================== -->
<div class="page-title">
  <div class="container">
    <div class="row">
      <div class="col-lg-12 col-md-12">
        <% if @towns %>
          <h4 class="ipt-title">Immobles a <%= @towns.join(', ') %></h4>
        <% end %>
      </div>
    </div>
  </div>
</div>
<!-- ============================ Page Title End ================================== -->
<!-- ============================ Properties ================================== -->
<section class="gray pt-4">
  <div class="container-fluid">
    <div class="row">
      <!-- Property Left Sidebar -->
      <div class="col-lg-4 col-md-4 col-sm-12">
        <div class="simple-sidebar sm-sidebar" id="filter_search"  style="left:0;">
          <div class="search-sidebar_header">
            <h4 class="ssh_heading">Close Filter</h4>
            <button onclick="closeFilterSearch()" class="w3-bar-item w3-button w3-large"><i class="fas fa-times"></i>
            </button>
          </div>
          <!-- Find New Property -->
          <div class="sidebar-widgets">
            <div class="search-inner p-0">
              <div class="filter-search-box">
                <div class="_mp_filter_first">
                  <div class="index-search">
                    <%= form_with url: realestates_path, method: :get, class: "d-flex" do |form| %>
                      <%= form.text_field :ref,
                      class: "form-control",
                      value: params[:ref],
                      placeholder: "Buscar per referència"
                    %>
                      <div class="input-group-append">
                        <%= form.button class: "input-group-text index-button", value: "cercar" do %>
                          <i class="fas fa-search fa-sm"></i>
                        <% end %>
                      </div>
                    <% end %>
                  </div>
                </div>
              </div>
              <%= form_with url: realestates_path, method: :get, class: "d-flex" do |form| %>
                <!-- All Search Fields -->
                <div class="filter_wraps">
                  <!-- Single Search -->
                  <div class="single_search_boxed">
                    <% if (params.values & @all_operations).length > 0 %>
                      <div class="widget-boxed-header">
                        <h4>
                          <a href="#rstype" data-bs-toggle="collapse" aria-expanded="false" role="button" class="collapsed"> Venda / Lloguer </a>
                        </h4>
                      </div>
                      <div class="widget-boxed-body collapse show" id="rstype" data-parent="#rstype">
                      <% else %>
                        <div class="widget-boxed-header">
                          <h4>
                            <a href="#rstype" data-bs-toggle="collapse" aria-expanded="false" role="button"> Venda / LLoguer </a>
                          </h4>
                        </div>
                        <div class="widget-boxed-body collapse" id="rstype" data-parent="#rstype">
                        <% end %>
                        <div class="side-list no-border">
                          <!-- Single Filter Card -->
                          <div class="single_filter_card">
                            <div class="card-body pt-0">
                              <div class="inner_widget_link">
                                <ul class="no-ul-list filter-list">
                                  <% @all_operations.each_with_index do |operation, index|%>
                                    <li>
                                      <% if params.values.include? operation %>
                                        <input id="o<%= index + 1 %>" class="radio-custom" name="op" type="radio" value="<%= operation %>" checked>
                                        <label for="o<%= index + 1 %>" class="radio-custom-label"><%= operation %></label>
                                      <% elsif %>
                                        <input id="o<%= index + 1 %>" class="radio-custom" name="op" type="radio" value="<%= operation %>">
                                        <label for="o<%= index + 1 %>" class="radio-custom-label"><%= operation %></label>
                                      <% end %>
                                    </li>
                                  <% end %>
                                </ul>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <!-- End Single Search -->
                    <!-- Single Search -->
                    <div class="single_search_boxed">
                      <% if (params.values & @all_towns).length > 0 %>
                        <div class="widget-boxed-header">
                          <h4>
                            <a href="#where" data-bs-toggle="collapse" aria-expanded="false" role="button">On busques? </a>
                          </h4>
                        </div>
                        <div class="widget-boxed-body collapse show" id="where" data-parent="#where">
                        <% else %>
                          <div class="widget-boxed-header">
                            <h4>
                              <a href="#where" data-bs-toggle="collapse" aria-expanded="false" role="button" class="collapsed">On busques? </a>
                            </h4>
                          </div>
                          <div class="widget-boxed-body collapse" id="where" data-parent="#where">
                          <% end %>
                          <div class="side-list no-border">
                            <!-- Single Filter Card -->
                            <div class="single_filter_card">
                              <div class="card-body pt-0">
                                <div class="inner_widget_link">
                                  <ul class="no-ul-list filter-list">
                                    <% @all_towns.each_with_index do |town, index|%>
                                      <li>
                                        <% if params.values.include? town %>
                                          <input id="m<%= index + 1 %>" class="checkbox-custom" name="m<%= index + 1 %>" value="<%= town %>" type="checkbox" checked>
                                          <label for="m<%= index + 1 %>" class="checkbox-custom-label"><%= town %></label>
                                        <% elsif %>
                                          <input id="m<%= index + 1 %>" class="checkbox-custom" name="m<%= index + 1 %>" value="<%= town %>" type="checkbox">
                                          <label for="m<%= index + 1 %>" class="checkbox-custom-label"><%= town %></label>
                                        <% end %>
                                      </li>
                                    <% end %>
                                  </ul>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <!-- End Single Search -->
                      <!-- Single Search -->
                      <div class="single_search_boxed">
                        <% if (params.values & @all_rstypes).length > 0 %>
                          <div class="widget-boxed-header">
                            <h4>
                              <a href="#rstype" data-bs-toggle="collapse" aria-expanded="false" role="button">Tipus immoble </a>
                            </h4>
                          </div>
                          <div class="widget-boxed-body collapse show" id="rstype" data-parent="#rstype">
                          <%  else %>
                            <div class="widget-boxed-header">
                              <h4>
                                <a href="#rstype" data-bs-toggle="collapse" aria-expanded="false" role="button" class="collapsed">Tipus immoble </a>
                              </h4>
                            </div>
                            <div class="widget-boxed-body collapse" id="rstype" data-parent="#rstype">
                            <% end %>
                            <div class="side-list no-border">
                              <!-- Single Filter Card -->
                              <div class="single_filter_card">
                                <div class="card-body pt-0">
                                  <div class="inner_widget_link">
                                    <ul class="no-ul-list filter-list">
                                      <% @all_rstypes.each_with_index do |rstype, index|%>
                                        <li>
                                          <% if params.values.include? rstype %>
                                            <input id="t<%= index + 1 %>" class="checkbox-custom" name="m<%= index + 1 %>" value="<%= rstype %>" type="checkbox" checked>
                                            <label for="t<%= index + 1 %>" class="checkbox-custom-label"><%= rstype %></label>
                                          <% elsif %>
                                            <input id="t<%= index + 1 %>" class="checkbox-custom" name="m<%= index + 1 %>" value="<%= rstype %>" type="checkbox">
                                            <label for="t<%= index + 1 %>" class="checkbox-custom-label"><%= rstype %></label>
                                          <% end %>
                                        </li>
                                      <% end %>
                                    </ul>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <!-- End Single Search -->
                        <!-- Single Search -->
                        <div class="single_search_boxed">
                          <% if params[:min].present? || params[:max].present? %>
                            <div class="widget-boxed-header">
                              <h4>
                                <a href="#salesprice" data-bs-toggle="collapse show" aria-expanded="false" role="button">Preu </a>
                              </h4>
                            </div>
                            <div class="widget-boxed-body collapse show" id="salesprice" data-parent="#salesprice">
                            <%  else %>
                              <div class="widget-boxed-header">
                                <h4>
                                  <a href="#salesprice" data-bs-toggle="collapse" aria-expanded="false" role="button" class="collapsed">Preu </a>
                                </h4>
                              </div>
                              <div class="widget-boxed-body collapse" id="salesprice" data-parent="#salesprice">
                              <% end %>
                              <div class="side-list no-border">
                                <!-- Single Filter Card -->
                                <div class="single_filter_card">
                                  <div class="card-body pt-0">
                                    <div class="row">
                                      <div class="col-lg-6 col-md-6 col-sm-12 p-2 elio">
                                        <div class="form-group mb-2">
                                          <div class="input-with-icon">
                                            <select name="min" id="minprice" class="form-control">
                                              <option value="">&nbsp;</option>
                                              <% @salesprices_array.each do |sp| %>
                                                <option value="<%= sp %>" <%= "selected" if params[:min] == sp.to_s %> ><%= sp %></option>
                                              <% end %>
                                            </select>
                                          </div>
                                        </div>
                                      </div>
                                      <div class="col-lg-6 col-md-6 col-sm-12 p-2 elio">
                                        <div class="form-group mb-2">
                                          <div class="input-with-icon">
                                            <select name="max" id="maxprice" class="form-control">
                                              <option value="">&nbsp;</option>
                                              <% @salesprices_array.each do |sp| %>
                                                <option value="<%= sp %>" <%= "selected" if params[:max] == sp.to_s %> ><%= sp %></option>
                                              <% end %>
                                            </select>
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                          <!-- End Single Search -->
                          <!-- Single Search Bedrooms -->
                          <div class="single_search_boxed">
                            <% if params[:hab].present? %>
                              <div class="widget-boxed-header">
                                <h4>
                                  <a href="#hab" data-bs-toggle="collapse" aria-expanded="false" role="button">Mín. Nº d'habitacions</a>
                                </h4>
                              </div>
                              <div class="widget-boxed-body collapse show" id="hab" data-parent="#hab">
                              <%  else %>
                                <div class="widget-boxed-header">
                                  <h4>
                                    <a href="#hab" data-bs-toggle="collapse" aria-expanded="false" role="button" class="collapsed">Mín. Nº d'habitacions</a>
                                  </h4>
                                </div>
                                <div class="widget-boxed-body collapse" id="hab" data-parent="#hab">
                                <% end %>
                                <div class="side-list no-border">
                                  <!-- Single Filter Card -->
                                  <div class="single_filter_card">
                                    <div class="card-body pt-0">
                                      <div class="inner_widget_link">
                                        <ul class="no-ul-list filter-list">
                                          <% @all_bedrooms.each_with_index do |hab, index|%>
                                            <li>
                                              <% if params[:hab] == hab.to_s %>
                                                <input id="hab<%= index + 1 %>" class="radio-custom" name="hab" type="radio" value="<%= hab %>" checked>
                                                <label for="hab<%= index + 1 %>" class="radio-custom-label"><%= hab %> hab. o més</label>
                                              <% elsif %>
                                                <input id="hab<%= index + 1 %>" class="radio-custom" name="hab" type="radio" value="<%= hab %>">
                                                <label for="hab<%= index + 1 %>" class="radio-custom-label"><%= hab %> hab. o més</label>
                                              <% end %>
                                            </li>
                                          <% end %>
                                        </ul>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                            <!-- End Single Search -->
                            <!-- End All Search Fields -->
                            <!-- Button Filter -->
                            <div class="form-group filter_button">
                              <button type="submit" class="btn btn btn-theme-light-2 rounded full-width">Cercar</button>
                            </div>
                            <!-- End Button Filter -->
                          <% end %>
                        </div>
                      </div>
                    </div>
                    <!-- End Find New Property -->
                  </div>
                </div>
                <!-- End Property Left Sidebar -->
                <!-- Right Side -->
                <div class="col-lg-8 col-md-12 list-layout">
                  <div class="row justify-content-center">
                    <div class="col-lg-12 col-md-12">
                      <div class="item-shorting-box">
                        <div class="item-shorting clearfix">
                          <div class="left-column pull-left">
                            <h4 class="m-0">
                              <%# If there is only one result %>
                              <% if params[:page].nil? && @all_realestates.count == 0  %>
                                No s'han trobat immobles d'aquestes caracteristiques.
                              <% elsif params[:page].nil? && @realestates.count == 1  %>
                                <%= @realestates.count %> immoble
                                <%# If it's the first page %>
                              <% elsif params[:page].nil? || params[:page] == 1 %>
                                1 - <%= @realestates.count %> de <%= @all_realestates.count %> immobles
                                <%# If params[:page] present and @realestates number == @pagy.items %>
                              <% elsif params[:page].present? && @realestates.count == @pagy.items %>
                                <%= (params[:page].to_i * @pagy.items) - (@pagy.items - 1) %> - <%= params[:page].to_i * @pagy.items %> de <%= @all_realestates.count %> immobles
                                <%# if params[:page] present and @realestates number < @pagy.items %>
                              <% elsif params[:page].present? && @realestates.count < @pagy.items %>
                                <%= (params[:page].to_i * @pagy.items) - (@pagy.items - 1) %> - <%= @all_realestates.count %> de <%= @all_realestates.count %> immobles
                              <% end %>
                            </h4>
                          </div>
                        </div>
                        <div class="item-shorting-box-right">
                          <ul class="shorting-list">
                            <li>
                              <%= link_to index_map_realestates_path, target: "_blank" do %>
                                <i class="fas fa-map-marked"></i>
                              <% end %>
                            </li>
                          </ul>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-----------------------------Filter----------------------------->
                  <div class="row">
                    <div class="col-lg-12 col-md-12">
                      <div class="sty_1523">
                        <div class="_mp_filter mb-3">
                          <div>
                            <%= link_to request.params.except(:page).merge(c: :salesprice, d: 'asc'), class: "map_filter min" do %>
                              <i class="fa fa-caret-up mr-2"></i>Primer preu més baix
                            <% end %>
                            <%= link_to request.params.except(:page).merge(c: :salesprice, d: 'desc'), class: "map_filter min" do %>
                              <i class="fa fa-caret-down mr-2"></i>Primer preu més alt
                            <% end %>
                            <!--Short Filter not applying for now----------------------
                <a href="#" class="map_filter min" data-bs-toggle="modal" data-bs-target="#filter"><i class="fa fa-sliders-h mr-2"></i>Short Filter</a>
                -----------------------Short Filter not applying for now-->
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-lg-12 col-md-12">
                      <div class="sty_1523">
                        <div class="_mp_filter center mb-3">
                          <div class="_mp_filter_last">
                            <div class="filter_list_item">
                              <div class="selected_item_wrap">
                                <% params.compact_blank.except(:action, :controller, :locale, :c, :d, :page, :button).each do |key, value| %>
                                  <div class="slt_single_item">
                                    <%= link_to request.params.except(key.to_sym), class: "remove_pills" do %>
                                      <span class="pills_tex"><%= key if key == "min" || key == "max" %> <%= value %> <%= "#{key}. o més" if key == "hab" %> </span>
                                      <span class="remove_cross"></span>
                                    <% end %>
                                  </div>
                                <% end %>
                                <% if params.except(:action, :controller, :locale, :c, :d, :page).values.length > 1 %>
                                  <div class="slt_single_item">
                                    <%= link_to realestates_path, class: "clear_pills" do %>
                                      <span class="pills_clears">Treure tots els filtres</span>
                                    <% end %>
                                  </div>
                                <% end %>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-----------------------------End Filter----------------------------->
                  <!-- Tots els immobles -->
                  <div class="row">
                    <% @realestates.each do |realestate| %>
                      <%= render realestate %>
                    <% end %>
                  </div>
                  <!-- End Tots els immobles -->
                  <!-- Pagination -->
                  <div class="d-flex justify-content-center">
                    <%== pagy_bootstrap_nav(@pagy) %>
                  </div>
                  <!-- End Pagination -->
                </div>
                <!-- End Right Side -->
              </div>
            </div>
          </section>
          <!-- ============================ End Properties ================================== -->
          <%# render partial: "shared/filter_modal" %>
